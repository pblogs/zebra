<% content_for :breadcrumb do %>
  <ul id="breadcrumb">
    <li><%= link_to 'Dashboard', private_home_path %></li>
    <li>Â»</li>
    <li><%= @page_title %></li>
  </ul>
<% end %>

<% if @crew %>

  <% form_tag :controller => 'private/clock_in', :action => "create", :method => :post do -%>

    <table class="no-border">
      <tr>
        <th>&nbsp;</th>
        <th>Name</th>
        <th>Clocked in at</th>
        <th>Clocked out at</th>
      </tr>
    <% @crew.users.each do |user| %>
      <tr class="<%= cycle('odd', 'even') %>">
      <% unless @clocked_in_ids.include?(user.id) %>
        <td class="span-1"><%= check_box_tag "users[][active]", "true", :checked => true %></td>
        <td class="span-4"><%= user.name %></td>
        <td>-</td>
        <td>-
          <%= hidden_field_tag "users[][user_id]", user.id %>
          <%= hidden_field_tag "users[][rate]", user.rate %>
          <%= hidden_field_tag "users[][bank_overtime_hours]", user.bank_overtime_hours %>
        </td>
      <% else %>
        <% @entry = TimeEntry.find(:first, :conditions => {:user_id => user.id, :time_sheet_id => nil, :active => true}) %>
        <td class="span-1"><%= check_box_tag "user", "active", true, :disabled => true %></td>
        <td class="span-4"><span class="quiet"><%= user.name %></span></td>
        <td><span class="quiet"><%= if @entry && @entry.clock_in : @entry.clock_in.strftime('%b-%d-%y at %I:%M %p') else "-" end %></span></td>
        <td><span class="quiet"><%= if @entry && @entry.clock_out : @entry.clock_out.strftime('%b-%d-%y at %I:%M %p') else "-" end %></span></td>
      <% end %>
      </tr>
    <% end %>
    </table>

    <% unless @clocked_in_ids.length == @crew.users.length %>
      <p>
        <label>Clock in at...</label>
        <br><%= datetime_select 'job', :started_on, { :minute_step => 15, :discard_year => true } %>
      </p>

      <p>
        <label>After Clock in...</label><br>
        <label class="normal"><%= radio_button_tag "navigate", "home", :checked => true %> Go to Home</label><br>
        <label class="normal"><%= radio_button_tag "navigate", "clock_in" %> Clock in users</label><br>
        <label class="normal"><%= radio_button_tag "navigate", "clock_out" %> Clock out users</label>
      </p>

      <p><%= submit_tag "Clock In Selected Users" %></p>
    <% else %>
      <p>All assigned users are already clocked in.
        <%= link_to "Clock Out now", {:controller => "private/clock_out", :action => "new", :job_id => @job.id} %>.
      </p>
    <% end %>

  <% end -%>

<% else %>
  <p>You are not assigned to a crew and cannot clock in.</p>
<% end %>