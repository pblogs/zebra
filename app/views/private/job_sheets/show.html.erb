<% content_for :breadcrumb do %>
  <ul id="breadcrumb">
    <li><%= link_to 'Dashboard', private_home_path %></li>
    <li>»</li>
    <li><%= link_to 'Job Sheets', private_job_sheets_path %></li>
    <li>»</li>
    <li><%= @page_title %></li>
  </ul>
<% end %>

<h2><%= job_label(@job_sheet.job) %></h2>
<p>Time Entries from <b><%= @job_sheet.time_sheets.length %></b> Time Sheets:</p>
<table>
  <tr>
    <th>#</th>
    <th>Date</th>
    <th>Name</th>
    <th class="right">Per Diem</th>
    <th class="right">Lunch</th>
    <th class="right">S/T</th>
    <th class="right">O/T</th>
    <th class="right">Total</th>
    <th class="right">Rate</th>
    <th class="right">Cost</th>
  </tr>
  <% @job_sheet.time_sheets.each do |time_sheet| %>
    <% time_sheet.time_entries.each do |entry| %>
    <tr class="<%= cycle('even', 'odd') %>">
      <td><%= entry.time_sheet.id %></td>
      <td>&nbsp;</td>
      <td><%= entry.user.name %></td>
      <td class="right">$<%= sprintf("%.2f", entry.per_diem) %></td>
      <td class="right"><%= sprintf("%.2f", entry.time_sheet.lunch.to_f / 60) %> Hours</td>
      <td class="right"><%= sprintf("%.2f", entry.straight_time) %> Hours</td>
      <td class="right"><%= sprintf("%.2f", entry.over_time) %> Hours</td>
      <td class="right"><%= sprintf("%.2f", entry.hours) %> Hours</td>
      <td class="right">$<%= sprintf("%.2f", entry.rate) %></td>
      <td class="right">$<%= sprintf("%.2f", entry.cost) %></td>
    </tr>
    <% end %>
  <% end %>
  <tr>
    <th colspan="3">&nbsp;</th>
    <th class="right">$<%= sprintf("%.2f", @job_sheet.total_per_diem) %></th>
    <th class="right"><%= sprintf("%.2f", @job_sheet.total_lunch_time) %> Hours</th>
    <th class="right"><%= sprintf("%.2f", @job_sheet.total_straight_time) %> Hours</th>
    <th class="right"><%= sprintf("%.2f", @job_sheet.total_over_time) %> Hours</th>
    <th class="right"><%= sprintf("%.2f", @job_sheet.total_hours) %> Hours</th>
    <th class="right">&nbsp;</th>
    <th class="right">$<%= sprintf("%.2f", @job_sheet.total_cost) %></th>
  </tr>
</table>

<br><br>

<div class="span-9 append-1">
  <h2>Miscellaneous</h2>
  <table>
    <tr>
      <th>Name</th>
      <th class="right">Cost</th>
    </tr>
    <tr>
      <td>Fuel</td>
      <td class="right"><%= if @job_sheet.total_fuel != 0 : "$#{sprintf("%.2f", @job_sheet.total_fuel)}" else "-" end %></td>
    </tr>
    <tr>
      <td>Hotels</td>
      <td class="right"><%= if @job_sheet.total_hotel != 0 : "$#{sprintf("%.2f", @job_sheet.total_hotel)}" else "-" end %></td>
    </tr>
    <tr>
      <th>&nbsp;</th>
      <th class="right">$<%= @job_sheet.total_misc_cost %></th>
    </tr>
  </table>
</div>

<div class="span-10">
  <h2>Equipment</h2>
  <table>
    <tr>
      <th>Unit</th>
      <th>Name</th>
      <th class="right">Rate</th>
      <th class="right">Cost</th>
    </tr>
  <% @job_sheet.job.equipments.each do |equipment| %>
    <tr>
      <td><%= equipment.unit %></td>
      <td><%= equipment.name %></td>
      <td class="right">$<%= sprintf("%.2f", equipment.rate) %></td>
      <td class="right">$<%= sprintf("%.2f", equipment.cost(@job_sheet)) %></td>
    </tr>
  <% end %>
    <tr>
      <th colspan="3">&nbsp;</th>
      <th class="right">$<%= sprintf("%.2f", @job_sheet.total_equipment_cost) %></th>
    </tr>
  </table>
</div>

<div class="span-4 last">
  <h2>&nbsp;</h2>
  <p>* Equipment Cost is Rate x Time Sheets</p>
</div>

<br class="clear">

<div class="span-9 append-1">
  <h2>Production</h2>
  <table>
    <tr>
      <th>Category</th>
      <th class="right">Ordered</th>
      <th class="right">Tally</th>
      <th class="right">Rate</th>
      <th class="right">Total</th>
    </tr>
    <% @job_marking_cats = [] %>

    <% @job_sheet.job.job_markings.each do |marking| %>
      <% @job_marking_cats << marking.gun_marking_category_id %>
      <tr>
        <td><%= marking.gun_marking_category.name %></td>
        <td class="right"><%= marking.amount %></td>
        <td class="right"><%= @job_sheet.total_markings(marking.gun_marking_category) %></td>
        <td class="right">$<%= sprintf("%.2f", marking.rate) %></td>
        <td class="right">$<%= sprintf("%.2f", @job_sheet.total_markings(marking.gun_marking_category) * marking.rate) %></td>
      </tr>
    <% end %>

    <% @job_sheet.gun_sheets.each do |gun| %>
      <% gun.gun_markings.each do |marking| %>
        <% unless @job_marking_cats.include?(marking.gun_marking_category_id.to_i) %>
          <tr>
            <td><%= marking.gun_marking_category.name %></td>
            <td class="right">-</td>
            <td class="right"><%= @job_sheet.total_markings(marking.gun_marking_category) %></td>
            <td class="right">-</td>
            <td class="right">-</td>
          </tr>
        <% end %>
      <% end %>
    <% end %>

  </table>
</div>



<div class="span-10">
  <h2>Materials</h2>
  <table>
    <tr>
      <th>Material</th>
      <th class="right">Distance</th>
      <th class="right">Usage</th>
      <th class="right">Cost</th>
    </tr>
    <tr>
      <td>Yellow Paint</td>
      <% if @job_sheet.total_yellow_paint != 0 %>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_yellow_paint) %> m</td>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_yellow_paint / 38.2) %> l</td>
        <td class="right">$<%= sprintf("%.2f", (@job_sheet.total_yellow_paint * @job_sheet.material_rate)) %></td>
      <% else %>
        <td class="right">-</td>
        <td class="right">-</td>
        <td class="right">-</td>
      <% end %>
    </tr>
    <tr>
      <td>White Paint</td>
      <% if @job_sheet.total_white_paint != 0 %>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_white_paint) %> m</td>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_white_paint / 38.2) %> l</td>
        <td class="right">$<%= sprintf("%.2f", (@job_sheet.total_white_paint * @job_sheet.material_rate)) %></td>
      <% else %>
        <td class="right">-</td>
        <td class="right">-</td>
        <td class="right">-</td>
      <% end %>
    </tr>
    <tr>
      <td>Beads</td>
      <% if @job_sheet.total_beads != 0 %>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_beads) %> m</td>
        <td class="right"><%= sprintf("%.2f", @job_sheet.total_beads / 600) %> g</td>
        <td class="right">$<%= sprintf("%.2f", (@job_sheet.total_beads * @job_sheet.material_rate)) %></td>
      <% else %>
        <td class="right">-</td>
        <td class="right">-</td>
        <td class="right">-</td>
      <% end %>
    </tr>
  </table>
</div>

<div class="span-4 last">
  <h2>&nbsp;</h2>
  <p>* Material Rate is $<%= sprintf("%.2f", @job_sheet.material_rate) %>/km</p>
</div>