<% content_for :breadcrumb do %>
  <ul id="breadcrumb">
    <li><%= link_to 'Dashboard', private_home_path %></li>
    <li>»</li>
    <li><%= link_to 'Material Reports', private_material_report_summaries_path %></li>
    <li>»</li>
    <li><%= @page_title %></li>
  </ul>
<% end %>

<% content_for :submenu do %>
  <%= render :partial => 'menus/material_report_summaries_menu', :layout => false %>
<% end %>

<table>
  <tr>
    <th class="span-3">Job</th>
    <td colspan="2" style="border-top: solid 1px #ccc">
      <%= @material_report_summary.job.label %>
      <%= link_to image_tag("open-link.png"), private_job_path(@material_report_summary.job), :class => "noprint" %>
    </td>
  </tr>
  <tr>
    <th "span-3">Gun Sheets</th>
    <td>
      <table>
        <% @material_report_summary.gun_sheets.each do |gun_sheet| %>
          <tr>
            <td>
              <%= gun_sheet.label %>
              <%= link_to image_tag("open-link.png"), edit_private_gun_sheet_path(gun_sheet), :class => "noprint" %>
            </td>
            <td>
              <% if gun_sheet.equipment_id %>
                <%= gun_sheet.equipment.name %>
                <%= link_to image_tag("open-link.png"), edit_private_equipment_path(gun_sheet.equipment), :class => "noprint" %><br />
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    </td>
  </tr>

  <tr>
    <th>Created By</th>
    <td colspan="2">
      <% if @material_report_summary.user %>
        <%= @material_report_summary.user.name %>
        <%= link_to image_tag("open-link.png"), edit_user_path(@material_report_summary.user), :class => "noprint" %>
      <% else %>
        Unknown
      <% end %>
    </td>
  </tr>
</table>

<table>
  <tr>
    <th class="span-3">&nbsp;</th>
    <th class="right">Y-1</th>
    <th class="right">Y-2</th>
    <th class="right">Y-3</th>
    <th class="right">W-4</th>
    <th class="right">W-5</th>
    <th class="right">W-6</th>
    <th class="right last">W-7</th>
  </tr>
  <% @yellow_l_km = 0 %>
  <% @white_l_km = 0 %>

  <% @yellow_l_km = @material_report_summary.gun_sheets.collect(&:yellow_length).sum %>
  <% @white_l_km = @material_report_summary.gun_sheets.collect(&:white_length).sum %>
  <tr>
    <th class="span-3">Solid</th>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y1).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y2).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y3).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w4).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w5).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w6).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w7).sum %></td>
  </tr>
  <tr>
    <th class="span-3">Skip</th>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_y1).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_y2).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_y3).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_w4).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_w5).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_w6).sum %></td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect(&:skip_w7).sum %></td>
  </tr>
    <tr>
      <th class="span-3">Total</th>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y1).sum + @material_report_summary.gun_sheets.collect(&:skip_y1).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y2).sum + @material_report_summary.gun_sheets.collect(&:skip_y2).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_y3).sum + @material_report_summary.gun_sheets.collect(&:skip_y3).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w4).sum + @material_report_summary.gun_sheets.collect(&:skip_w4).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w5).sum + @material_report_summary.gun_sheets.collect(&:skip_w5).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w6).sum + @material_report_summary.gun_sheets.collect(&:skip_w6).sum %></td>
      <td class="right"><%= @material_report_summary.gun_sheets.collect(&:solid_w7).sum + @material_report_summary.gun_sheets.collect(&:skip_w7).sum %></td>
    </tr>
</table>

<br>

<table>
  <tr>
    <th class="span-3">&nbsp;</th>
    <th class="right">Total Used</th>
    <th class="right">Solid+Skip Line KM</th>
    <th class="right">Used/Line KM</th>
    <th class="right">Target</th>
  </tr>
  <tr>
    <th>Yellow</th>
    <td class="right"><span id="summary_total_yellow_used"></span> L</td>
    <td class="right" id="summary_yellow_length"><%= @material_report_summary.gun_sheets.collect(&:yellow_length).sum %></td>
    <td class="right" id="summary_yellow_calculation"></td>
    <td class="right">38 L/KM</td>
  </tr>

  <tr>
    <th>White</th>
    <td class="right"><span id="summary_total_white_used"></span> L</td>
    <td class="right" id="summary_white_length"><%= @material_report_summary.gun_sheets.collect(&:white_length).sum %></td>
    <td class="right" id="summary_white_calculation"></td>
    <td class="right">38 L/KM</td>
  </tr>

  <tr>
    <th>Bead</th>
    <td class="right"><span id="summary_bead_used"></span> KG</td>
    <td class="right" id="summary_bead_length"></td>
    <td class="right" id="summary_bead_calculation"></td>
    <td class="right">22.2 KG/KM</td>
  </tr>
</table>

<br>

<table>
  <tr>
    <th>Production</th>
    <th class="right">Amount</th>
  </tr>
  <tr>
    <td>Interchanges</td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect{ |gs| if gs.interchanges.blank? then 0 else gs.interchanges end }.sum %></td>
  </tr>
  <tr>
    <td>Sides</td>
    <td class="right"><%= @material_report_summary.gun_sheets.collect{|gs| if gs.sides.blank? then 0 else gs.sides end }.sum %></td>
  </tr>
</table>
